<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ íŠ¸ë˜í”½ ëª¨ë‹ˆí„°ë§</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: crosshair;
            user-select: none;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 800px;
            width: 90%;
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            color: #666;
            margin: 10px 0 0 0;
            font-size: 1.1em;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            border: 2px dashed rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .chart-container:hover {
            border-color: rgba(102, 126, 234, 0.6);
            transform: scale(1.02);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            text-align: center;
        }
        
        .stat-item {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            min-width: 120px;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #4CAF50;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
        }
        
        .controls p {
            margin: 5px 0;
            color: #666;
            font-size: 0.9em;
        }
        
        .shot-effect {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ff6b6b, transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: shotAnimation 0.5s ease-out forwards;
            z-index: 1000;
        }
        
        @keyframes shotAnimation {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                transform: scale(2);
                opacity: 0.8;
            }
            100% {
                transform: scale(3);
                opacity: 0;
            }
        }
        
        .traffic-spike {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6b6b;
            font-size: 2em;
            font-weight: bold;
            pointer-events: none;
            animation: spikeAnimation 1s ease-out forwards;
            z-index: 1001;
        }
        
        @keyframes spikeAnimation {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(2) translateY(-50px);
                opacity: 0;
            }
        }
        
        .chart-container.shooting {
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="status-indicator"></span>ì‹¤ì‹œê°„ íŠ¸ë˜í”½ ëª¨ë‹ˆí„°ë§</h1>
            <p>ê²Œì„ ì„œë²„ íŠ¸ë˜í”½ í˜„í™© - íŠ¸ë™ì„ ì˜ì•„ë³´ì„¸ìš”!</p>
        </div>
        
        <div class="controls">
            <p>ğŸ¯ ì°¨íŠ¸ ì˜ì—­ì„ í´ë¦­í•˜ê±°ë‚˜ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ íŠ¸ë˜í”½ì„ ì¦ê°€ì‹œí‚¤ì„¸ìš”</p>
            <p>â¬†ï¸ â¬‡ï¸ í™”ì‚´í‘œ í‚¤ë¡œë„ íŠ¸ë˜í”½ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>
        
        <div class="chart-container" id="chartContainer">
            <canvas id="trafficChart"></canvas>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="currentTraffic">0</div>
                <div class="stat-label">í˜„ì¬ íŠ¸ë˜í”½</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="peakTraffic">0</div>
                <div class="stat-label">ìµœê³  íŠ¸ë˜í”½</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="avgTraffic">0</div>
                <div class="stat-label">í‰ê·  íŠ¸ë˜í”½</div>
            </div>
        </div>
    </div>

    <script>
        // ì°¨íŠ¸ ì„¤ì •
        const ctx = document.getElementById('trafficChart').getContext('2d');
        const maxDataPoints = 50;
        let trafficData = [];
        let labels = [];
        let currentTraffic = 0;
        let peakTraffic = 0;
        let totalTraffic = 0;
        let dataCount = 0;
        let isShooting = false;

        // ì´ˆê¸° ë°ì´í„° ìƒì„±
        for (let i = 0; i < maxDataPoints; i++) {
            const time = new Date();
            time.setSeconds(time.getSeconds() - (maxDataPoints - i));
            labels.push(time.toLocaleTimeString());
            trafficData.push(Math.floor(Math.random() * 100) + 50);
        }

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'íŠ¸ë˜í”½ (requests/sec)',
                    data: trafficData,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    pointHoverBackgroundColor: 'rgb(75, 192, 192)',
                    pointHoverBorderColor: '#fff',
                    pointHoverBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        display: true,
                        title: {
                            display: true,
                            text: 'ì‹œê°„',
                            color: '#666'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        },
                        ticks: {
                            color: '#666',
                            maxTicksLimit: 10
                        }
                    },
                    y: {
                        display: true,
                        title: {
                            display: true,
                            text: 'íŠ¸ë˜í”½ (requests/sec)',
                            color: '#666'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        },
                        ticks: {
                            color: '#666',
                            beginAtZero: true
                        }
                    }
                },
                animation: {
                    duration: 750,
                    easing: 'easeInOutQuart'
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });

        // íŠ¸ë˜í”½ ì¦ê°€ í•¨ìˆ˜
        async function increaseTraffic(amount = 50) {
            try {
                // ì‹¤ì œ APIì— íŠ¸ë˜í”½ ê¸°ë¡ ìš”ì²­
                await fetch('/api/traffic/record', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                // ì‹œê°ì  íš¨ê³¼ ì¶”ê°€
                createShotEffect();
                createTrafficSpike(amount);
                
                // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆì— ì˜ëŠ” íš¨ê³¼
                const chartContainer = document.getElementById('chartContainer');
                chartContainer.classList.add('shooting');
                setTimeout(() => {
                    chartContainer.classList.remove('shooting');
                }, 300);
            } catch (error) {
                console.error('Failed to record traffic:', error);
            }
        }

        // ì˜ëŠ” íš¨ê³¼ ìƒì„±
        function createShotEffect() {
            const effect = document.createElement('div');
            effect.className = 'shot-effect';
            effect.style.left = Math.random() * 80 + 10 + '%';
            effect.style.top = Math.random() * 80 + 10 + '%';
            document.body.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 500);
        }

        // íŠ¸ë˜í”½ ìŠ¤íŒŒì´í¬ í…ìŠ¤íŠ¸ ìƒì„±
        function createTrafficSpike(amount) {
            const spike = document.createElement('div');
            spike.className = 'traffic-spike';
            spike.textContent = `+${amount}`;
            document.body.appendChild(spike);
            
            setTimeout(() => {
                spike.remove();
            }, 1000);
        }

        // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateTraffic() {
            try {
                // ì‹¤ì œ APIì—ì„œ íŠ¸ë˜í”½ ë©”íŠ¸ë¦­ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/api/traffic/metrics');
                if (response.ok) {
                    const metrics = await response.json();
                    
                    // ì‹¤ì œ íŠ¸ë˜í”½ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
                    currentTraffic = metrics.currentRPS;
                    
                    // ìµœê·¼ ë°ì´í„°ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    if (metrics.recentData && metrics.recentData.length > 0) {
                        trafficData = [...metrics.recentData];
                        // ë¼ë²¨ë„ ì—…ë°ì´íŠ¸
                        labels = [];
                        for (let i = 0; i < trafficData.length; i++) {
                            const time = new Date();
                            time.setSeconds(time.getSeconds() - (trafficData.length - i));
                            labels.push(time.toLocaleTimeString());
                        }
                    }
                    
                    // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    chart.data.labels = labels;
                    chart.data.datasets[0].data = trafficData;
                    chart.update('none');
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    document.getElementById('currentTraffic').textContent = currentTraffic;
                    document.getElementById('peakTraffic').textContent = metrics.peakRPS;
                    document.getElementById('avgTraffic').textContent = metrics.averageRPS;
                }
            } catch (error) {
                console.error('Failed to fetch traffic metrics:', error);
                // API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ìœ ì§€
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ëŠ” APIì—ì„œ ì§ì ‘ ì²˜ë¦¬í•˜ë¯€ë¡œ ì œê±°
        // updateStats í•¨ìˆ˜ ì‚­ì œë¨

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.addEventListener('click', (e) => {
            // ì°¨íŠ¸ ì˜ì—­ í´ë¦­ ì‹œ íŠ¸ë˜í”½ ì¦ê°€
            const chartContainer = document.getElementById('chartContainer');
            if (chartContainer.contains(e.target)) {
                increaseTraffic(30);
                isShooting = true;
            }
        });

        document.addEventListener('keydown', (e) => {
            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    increaseTraffic(50);
                    isShooting = true;
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    increaseTraffic(20);
                    isShooting = true;
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    increaseTraffic(10);
                    isShooting = true;
                    break;
            }
        });

        // 1ì´ˆë§ˆë‹¤ ë°ì´í„° ì—…ë°ì´íŠ¸
        setInterval(updateTraffic, 1000);
        
        // ì´ˆê¸° ì‹¤í–‰
        updateTraffic();
    </script>
</body>
</html>
